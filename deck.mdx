import { Appear, Notes } from 'mdx-deck';
import {
    fetchMock,
    loadableMock,
    CodeBlock,
    renderAppTest,
    renderApp,
    renderPartial,
    renderPartialTest,
    cookieMock,
    renderTest,
    scripts
} from './components';
import 'isomorphic-style-loader!css-loader!codemirror/lib/codemirror.css';
import 'isomorphic-style-loader!css-loader!./cm-night-owl.css';
import 'isomorphic-style-loader!css-loader!./styles.css';
import './script.js';

export { default as theme } from './theme';

# Testing the PADM with Jest

<p>Emile Choghi</p>

---

# What this talk is

-   What Jest is and how to use it.
-   Setting up the PADM testing environment.
-   How to test our components.
-   What comes next for the PADM?

---

# What is Jest?

-   Open source testing library, written by Facebook.
-   For testing all JavaScript code, popular with React.
-   Uses Jasmine as its testing engine.
-   Zero config necessary, lots of tools.

---

# What's inside? üì¶

<ul style={{ fontSize: 40, textAlign: 'left' }}>
    <Appear>
        <li>Snapshot testing.</li>
        <li>Coverage reports.</li>
        <li>Default browser-like environment (JSDOM).</li>
        <li>Interactive "watch" mode</li>
        <li>
            Lots of{' '}
            <a href="https://jestjs.io/docs/en/expect" target="_blank">
                matchers
            </a>
        </li>
    </Appear>
</ul>

```notes
- snapshot testing is a new form of testing built into Jest that lets us know when our UI has changed.
- The first time it runs it generates a snapshot file in the same directory and checks all future tests against it.
- Good for quick regression testing but not a replacement for other forms of testing.
- thorough coverage reports with Istanbul.
- watch mode for development, filter by test file or name.
```

---

# Setting up the test environment

-   JSDOM doesn't support every DOM API (e.g. localStorage, cookies..).
-   Network requests should not be fired in tests.
-   Static assets need to be handled.
-   Code must be transpiled with babel.

---

# So what is a mock?

<ul style={{ fontSize: 40, textAlign: 'left' }}>
    <Appear>
        <li>Captures calls.</li>
        <li>Sets return values.</li>
        <li>Controls implementation.</li>
        <li>Replaces a module we don‚Äôt control with something we do.</li>
    </Appear>
</ul>

---

<CodeBlock>{fetchMock}</CodeBlock>

<div style={{ fontSize: 20 }}>
    <div>Theme: Night Owl by Sarah Drasner</div>
    <div>Font: Dank Mono by Phil Pl√ºckthun</div>
</div>

---

<CodeBlock>{loadableMock}</CodeBlock>

---

<CodeBlock>{cookieMock}</CodeBlock>

---

# Writing Tests ‚úç

-   Write tests. Not too many. Mostly integration. - Guillermo Rauch‚Äè
-   Don't rely on snapshots, keep them small.
-   You should very rarely have to change tests when you refactor code.

---

# How do we write tests?

---

## testUtils: renderApp

<CodeBlock>{renderApp}</CodeBlock>

---

## renderApp usage

<CodeBlock>{renderAppTest}</CodeBlock>

---

## testUtils: renderPartial

<CodeBlock>{renderPartial}</CodeBlock>

---

<CodeBlock>{renderPartialTest}</CodeBlock>

---

## render usage

<CodeBlock>{renderTest}</CodeBlock>

---

# Running tests üèÉ

<CodeBlock>{scripts}</CodeBlock>

---

# What's next?

-   Improve test coverage: important business logic.
-   Continuous integration with Jenkins.
-   Type checking.
-   Automated testing with API Fortress

---

# Extras üéâ

-   New error overlay for development server.
-   Reduced main bundle size by almost 90%.
-   Faster build times with Webpack 4 and Babel 7.
-   Improved code chunking.
-   Less webpack config.

---

# Thank You

<img width="70px" height="70px" src="public/standard/wave.png" />

[testing-padm.netlify.com](https://testing-padm.netlify.com/)
